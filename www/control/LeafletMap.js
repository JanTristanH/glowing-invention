sap.ui.define(["sap/ui/core/Control","hwb/frontendhwb/control/LeafletSpot"],function(t,e){"use strict";const i=["10.615779999999972","51.80054"];const o=15;return t.extend("hwb.frontendhwb.LeafletMap",{_oMap:null,metadata:{properties:{initialPosition:{type:"string",defaultValue:"0;0"},initialZoom:{type:"int",defaultValue:10},centerPosition:{type:"string",defaultValue:"0;0"},zoomlevel:{type:"int",defaultValue:10},height:{type:"string",defaultValue:"100%"},width:{type:"string",defaultValue:"100%"}},defaultAggregation:"spots",aggregations:{spots:{type:"hwb.frontendhwb.Spots",multiple:true,singularName:"spot"},routes:{type:"hwb.frontendhwb.Routes",multiple:true,singularName:"route"}},events:{zoomChanged:{},centerChanged:{}}},init:function(){},invalidate:function(){console.debug("LeafletMap: suppressing invalidate()");clearTimeout(this._invalidateTimeout);this._invalidateTimeout=setTimeout(()=>{this.invalidateSize();this._renderSpots();this._renderRoutes()},250)},exit:function(){console.error("LeafletMap: exiting control");if(this._oMap){this._oMap.remove();this._oMap=null}},onAfterRendering:function(){if(!this._oMap){const t=this.getDomRef();this._oMap=L.map(t,{center:this._parsePosition(this.getInitialPosition()),zoom:this.getInitialZoom()});L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"Map data Â© OpenStreetMap contributors"}).addTo(this._oMap);this._oMap.on("zoomend",()=>{this.fireZoomChanged({zoomLevel:this._oMap.getZoom()})});this._oMap.on("moveend",()=>{const t=this._oMap.getCenter();const e=t.lng+";"+t.lat;this.fireCenterChanged({centerPoint:e});clearTimeout(this._invalidateTimeout)});this._oMap.on("movestart",()=>{clearTimeout(this._invalidateTimeout)})}const t=this.getAggregation("spots")||[];t.forEach(t=>{t.attachEvent("_change",this._renderSpots,this);if(typeof t.updateItems==="function"){t.updateItems()}});this._renderSpots();const e=this.getAggregation("routes")||[];e.forEach(t=>{t.attachEvent("_change",this._renderRoutes,this);if(typeof t.updateItems==="function"){t.updateItems()}});this._renderRoutes()},updateAggregation:function(e){t.prototype.updateAggregation.apply(this,arguments);if(e==="spots"){this._renderSpots()}if(e==="routes"){this._renderRoutes()}},updateItems:function(){},_parsePosition:function(t){var e=t?.split(";")??i;e=t=="undefined"?i:e;return[parseFloat(e[1]),parseFloat(e[0])]},_renderSpots:function(){if(!this._oMap)return;if(this._aMarkers){this._aMarkers.forEach(t=>t.remove())}this._aMarkers=[];const t=this.getAggregation("spots")?.flatMap(t=>t.getAggregation("items")).filter(t=>!!t)||[];t.forEach(t=>{const e=t.getMarker();if(!e){console.warn("LeafletMap: No marker found for spot");return}e.addTo(this._oMap);this._aMarkers.push(e)})},_renderRoutes:function(){if(!this._oMap)return;if(this._aPolyline){this._aPolyline.forEach(t=>t.remove())}this._aPolyline=[];const t=this.getAggregation("routes")?.flatMap(t=>t.getAggregation("items")).filter(t=>!!t)||[];t.forEach(t=>{const e=t.getPolyline();if(!e){console.warn("LeafletMap: No polyline found for route");return}e.addTo(this._oMap);this._aPolyline.push(e)})},setCenterPosition:function(t){var e=this._parsePosition(t);this._oMap?.panTo(e,{animate:true,duration:.5})},zoomToGeoPosition:function(t,e,i){this._oMap?.setView([parseFloat(e)-.004,parseFloat(t)],i??this.getZoomlevel())},invalidateSize:function(){this._oMap.invalidateSize()},renderer:{render:function(t,e){t.write("<div");t.writeControlData(e);t.addStyle("height",e.getHeight());t.addStyle("width",e.getWidth());t.writeStyles();t.write("></div>")}}})});
//# sourceMappingURL=LeafletMap.js.map