sap.ui.define(["hwb/frontendhwb/controller/BaseController","sap/m/MessageToast","sap/ui/core/Fragment","sap/ui/model/json/JSONModel","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/m/MessageBox"],function(e,t,i,r,n,s,a){"use strict";return e.extend("hwb.frontendhwb.controller.List",{onInit:function(){e.prototype.onInit.apply(this,arguments);this.disableSelectAll();this.attachGroupChange();this.getModel("app").setProperty("/selectedFilterKey","all")},onAfterRendering:function(){this.getView().byId("navButtonListId").setType("Emphasized")},attachGroupChange:function(){this.getModel("app").attachPropertyChange(e=>{if(e.getParameter("path")=="/aSelectedGroupIds"){this.applyGroupFilter()}})},applyGroupFilter:function(){let e=this.getModel("app").getProperty("/aSelectedGroupIds")||[];e=JSON.parse(JSON.stringify(e));let t=this.getModel("app").getProperty("/currentUser");e.push(t.ID);let i=new n("groupFilterStampings",s.NE,e.join(","));const r=this.byId("StampingsTable").getBinding("items");if(r){r.filter(e.length>1?i:null)}},disableSelectAll(){this._myDelegate={onAfterRendering:function(){if(typeof this._getSelectAllCheckbox==="function"&&this._getSelectAllCheckbox().isA("sap.m.CheckBox")){this._getSelectAllCheckbox().setVisible(false)}}};let e=this.getView().byId("StampingsTable");e.addEventDelegate(this._myDelegate,e)},updateStampCount:function(){var e=this.byId("StampingsTable");var t=e.getSelectedItems().length??0;this.getModel("app").setProperty("/selectedCount",t)},onSelectionChange:function(e){this.updateStampCount();var i=e.getParameter("listItem");var r=i.getBindingContext().getObject();let n=this.getView().getModel();if(e.getParameter("selected")){let e=r.ID;let s={success:()=>t.show(this.getText("savedStamping"))||n.refresh(),error:()=>t.show("An Error Occurred")||i.setSelected(false)};n.create("/Stampings",{stamp:{ID:e}},s)}else{let e=this.getModel().getProperty("/"+i.getBindingContext().getProperty("Stampings")[0]);let r=e.ID;a.confirm(this.getResourceBundle().getText("confirmDeletionOfX",i.getBindingContext().getProperty("name")),{icon:a.Icon.WARNING,title:this.getText("confirmDeletionTitle"),actions:[a.Action.YES,a.Action.NO],emphasizedAction:a.Action.NO,onClose:e=>{if(e===a.Action.YES){let e={success:()=>{t.show(this.getText("deletedStamping"));n.invalidate()},error:()=>t.show("An Error Occurred")||i.setSelected(true)};n.remove(`/Stampings(${r})`,e)}else{i.setSelected(true)}}})}},onStampingsUpdateFinished:function(e){this.selectWhere(e=>e.getProperty("hasVisited"));this.updateStampCount()},selectWhere:function(e){const t=this.byId("StampingsTable");t.getItems().forEach(i=>{if(e(i.getBindingContext())){t.setSelectedItemById(i.getId())}});return t},onListItemPress:function(e){const t=e.getSource().getBindingContext().getProperty("ID");this.getRouter().navTo("MapWithPOI",{idPOI:t})},onShowBagdesButtonPress:function(e){const t=this.getView();if(!this.pBadgeProgressDialog){this.pBadgeProgressDialog=i.load({id:t.getId(),name:"hwb.frontendhwb.fragment.BadgeProgressDialog",controller:this}).then(function(e){t.addDependent(e);return e})}this.pBadgeProgressDialog.then(e=>{let t=this.byId("StampingsTable");const i=t.getSelectedItems();let n=i.length;const s=i.map(e=>e.getCells()[0].getText());e.setModel(new r({iSelectedCount:n,iRiserProgressCount:this.getRiserProgressCount(s),aRequiredStampsRiser:this.getRequiredStampsRiser(),iBoarderProgressCount:this.getBoarderProgressCount(s),aRequiredStampsBoarder:this.getRequiredStampsBoarder(),iGoetheProgressCount:this.getGoetheProgressCount(s),aRequiredStampsGoethe:this.getRequiredStampsGoethe(),iWitchProgressCount:this.getWitchTrailPercentage(s),aRequiredStampsWitchTrail:this.getRequiredStampsWithTrail()}),"localDialog");e.open(e)})},aBorderRequiredStamps:[1,2,3,4,9,10,11,18,19,46,90,136,156,159,164,165,166,167,168,170].map(e=>""+e),getBoarderProgressCount:function(e){const t=e.filter(e=>this.aBorderRequiredStamps.includes(e));return t.length},getRequiredStampsBoarder:function(){return this.aBorderRequiredStamps.map(e=>this.getStampByNumber(e)).map(e=>({ID:e.ID,name:e.name,number:e.number,visited:e.Stampings.__list.length!=0}))},aGoetheRequiredStamps:[9,13,14,31,38,41,42,62,69,71,78,80,85,88,91,95,99,101,105,116,117,129,132,136,140,144,155,188].map(e=>""+e),getGoetheProgressCount:function(e){const t=e.filter(e=>this.aGoetheRequiredStamps.includes(e));return t.length},getRequiredStampsGoethe:function(){return this.aGoetheRequiredStamps.map(e=>this.getStampByNumber(e)).map(e=>({ID:e.ID,name:e.name,number:e.number,visited:e.Stampings.__list.length!=0}))},aWitchTrailRequiredStamps:[69,140,9,13,17,22,40,41,42,52,60,62,63,123,128,133,136,137,155,178].map(e=>""+e),getWitchTrailPercentage:function(e){let t=this.aWitchTrailRequiredStamps.filter(e=>e!="69"&&e!="140");const i=e.filter(e=>t.includes(e));let r=Math.min(i.length,9);if(e.includes("69")){r++}if(e.includes("140")){r++}return r},getRequiredStampsWithTrail:function(){return this.aWitchTrailRequiredStamps.map(e=>this.getStampByNumber(e)).map(e=>{if(e.number=="69"||e.number=="140"){e.name=`${e.name} ${this.getText("required")}`}return{ID:e.ID,name:e.name,number:e.number,visited:e.Stampings.__list.length!=0}})},aRiserRequiredStamps:[37,39,60,61,85,91,107,113,126,127,128,133,137,146,155,172,175,179,190,193,194,217,222].map(e=>""+e),getRiserProgressCount:function(e){let t=e.length;t=Math.min(t,111);const i=e.filter(e=>this.aRiserRequiredStamps.includes(e));const r=this.aRiserRequiredStamps.length-i.length;return Math.max(t-r,0)},getRequiredStampsRiser:function(){return this.aRiserRequiredStamps.map(e=>this.getStampByNumber(e)).map(e=>({ID:e.ID,name:e.name,number:e.number,visited:e.Stampings.__list.length!=0}))},onCloseButtonPress:function(e){this.pBadgeProgressDialog.then(e=>e.close())},calculatePercentage:function(e,t){if(!e||!t||t<=0){return 0}return Math.min(e/t*100,100)},min:function(e,t){return Math.min(e,t)},calculateValueColor:function(e,t){let i=e/t*100;return this.calculateValueColorPercentage(i)},calculateValueColorPercentage:function(e){if(e>=100){return"#4caf50"}else if(e===0){return"#9e9e9e"}else{return"#3278be"}},onStampNavigatePress:function(e){const t=e.getSource().data("ID");this.getRouter().navTo("MapWithPOI",{idPOI:t})},onFormatColumnVisibility:function(e,t){const i=t?.length>=parseInt(e)+1;if(i){const i=t[e];this.addColumnName(e,i)}return i},addColumnName:function(e,i){const r=[new n("ID",s.EQ,i)];this.getModel().read("/Users",{filters:r,success:function(t){this.getModel("app").setProperty("/userName"+e,t.results[0].name)}.bind(this),error:function(e){t.show(this.getText("error"))}})},onFormatListItemVisible:function(e,t){if(!e||e=="all"){return true}if(e=="stamped"&&t){return true}if(e=="unstamped"&&!t){return true}return false},onFormatGroupSelected:function(e,t,i){if(!t||!t.length){return false}const r=t[e];return i.includes(r)}})});
//# sourceMappingURL=List.controller.js.map