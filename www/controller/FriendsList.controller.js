sap.ui.define(["hwb/frontendhwb/controller/BaseController","sap/m/MessageToast","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/core/Fragment"],function(e,t,n,i,s){"use strict";return e.extend("hwb.frontendhwb.controller.FriendsList",{onInit:function(){e.prototype.onInit.apply(this,arguments);if(!this._oFriendListItemTemplate){this._oFriendListItemTemplate=s.load({id:this.getView().getId(),name:"hwb.frontendhwb.fragment.FriendListItem",controller:this})}},onAfterRendering:function(){this.byId("navButtonFriendsId").setType("Emphasized");const e=this.getModel("app").getProperty("/currentUser/ID");if(!e){setTimeout(this.onAfterRendering.bind(this),250);return}const t=new n("fromUser_ID",i.EQ,e);const s=this.byId("idPendingFriendshipRequestsList").getBinding("items");s.filter([t])},onAddFriend:function(e){var n=e.getSource();var i=n.getBindingContext();if(!i){t.show("No friend context found.");return}var s=i.getObject();let r=this.getModel("app").getProperty("/currentUser");let o=r.ID;this.getModel().create("/Friendships",{fromUser:{ID:o},toUser:{ID:s.ID}},{success:function(){this.getModel().refresh();t.show(this.getText("friendshipCreated"));this.getModel().refresh()}.bind(this),error:function(e){t.show(this.getText("errorCreatingFriendship"));console.error("Error creating friendship:",e)}.bind(this)})},onRemoveFriend:function(e){var n=e.getSource();var i=n.getBindingContext();if(!i){t.show("No friend context found.");return}var s=i.getObject().FriendshipID;if(s){var r=new sap.m.Dialog({title:this.getText("confirmRemoveAction"),type:"Message",content:new sap.m.Text({text:this.getText("confirmRemoveFriendMessage")}),beginButton:new sap.m.Button({text:this.getText("remove"),press:function(){var e=this.getView().getModel();e.remove(`/Friendships(${s})`,{success:function(){t.show(this.getText("friendRemoved"));this.getModel().refresh()}.bind(this),error:function(e){t.show(this.getText("errorRemovingFriend"))}.bind(this)});r.close()}.bind(this)}),endButton:new sap.m.Button({text:this.getText("cancel"),press:function(){r.close()}})});r.open()}else{t.show(this.getText("errorRemovingFriend"))}},onNavToFriendPress:function(e){const n=e.getSource().getBindingContext()??e.getParameter("listItem").getBindingContext();if(!n){t.show("No friend context found.");return}const i=n.getObject().ID;this.getRouter().navTo("Profile",{userId:i})},onFriendSelectionChange:function(e){const t=e.getParameter("listItem");const n=t.getBindingContext();t.setSelected(false);const i=n.getObject().ID;this.getRouter().navTo("Profile",{userId:i})},onAcceptPendingFriendshipRequest:function(e){const t=this.getView().getModel();const n=e.getSource().getBindingContext();const i=n.getProperty("ID");var s=new sap.m.Dialog({title:this.getText("confirmFrienshipAction"),type:"Message",content:new sap.m.Text({text:this.getText("confirmAcceptRequestMessage")}),beginButton:new sap.m.Button({text:this.getText("accept"),type:"Emphasized",press:function(){t.callFunction("/acceptPendingFriendshipRequest",{method:"POST",urlParameters:{FriendshipID:i},success:function(){this.getModel().refresh();sap.m.MessageToast.show(this.getText("friendshipRequestAccepted"))}.bind(this),error:function(e){console.error("Error accepting friendship request:",e);sap.m.MessageToast.show(this.getText("error"))}.bind(this)});s.close()}.bind(this)}),endButton:new sap.m.Button({text:this.getText("decline"),press:function(){t.remove(`/PendingFriendshipRequests(${i})`,{success:function(){sap.m.MessageToast.show(this.getText("friendshipRequestDeclined"))}.bind(this),error:function(e){console.error("Error declining friendship request:",e);sap.m.MessageToast.show(this.getText("error"))}.bind(this)});s.close()}})});s.open()},onUpdateFinished:function(e){var t=e.getSource().getBinding("items");var n=this.byId("pendingFriendshipRequestsIconTabFilter");var i=this.getText("pendingFriendshipRequests")+` (${t.getLength()})`;n.setText(i)},onSearchFieldLiveChange:function(e){const t=e.getParameter("newValue");const s=this.byId("idFriendsList");let r=t===""?"/MyFriends":"/Users";let o=t===""?this.getText("friendListHeader"):this.getText("wanderbuddies");s.setHeaderText(o);Promise.resolve(this._oFriendListItemTemplate).then(function(e){s.bindAggregation("items",{path:r,factory:function(t,n){return e.clone(t)}});if(t!==""){const e=s.getBinding("items");if(e){const s=new n("name",i.Contains,t);const r=new n("name",i.Contains,t.toLowerCase());const o=t.charAt(0).toUpperCase()+t.slice(1);const d=new n("name",i.Contains,o);const c=new n({filters:[s,r,d],and:false});e.filter(c)}}})}})});
//# sourceMappingURL=FriendsList.controller.js.map